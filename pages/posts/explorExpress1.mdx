import Layout from 'lib/components/layout'
import { Spacer, Link, Dot, Description, Code } from '@geist-ui/react'

export const meta = {
  title: 'Express源码探究-初露锋芒',
  date: '2021-01-04T02:59:48.275Z',
  description: '',
}

这篇博文旨在记录作者学习`express`源码的过程,以及`express`源码部分拆解实现的过程。因为我发现学习一门框架的最好方式就是实现一个框架,因此我想用一种渐进式的方式,从实现一个简单的
`web`服务器直至一个接近完整的`express`。

在开始实现`express`前,我想分享下如何学习`express`源码,我是将学习的方式分为三步:

<div style={{ lineHeight: '26px' }}>
  <Dot style={{ marginRight: '5px' }} type="success" />
  领悟思想：只需体会作者设计框架的初衷和目的
</div>
<Spacer />
<div style={{ lineHeight: '26px' }}>
  <Dot style={{ marginRight: '5px' }} type="error" />
  把握设计：只需体会代码的接口和抽象类以及宏观的设计
</div>
<Spacer />
<div style={{ lineHeight: '26px' }}>
  <Dot style={{ marginRight: '5px' }} type="warning" />
  体会细节：是基于顶层的抽象接口设计，逐渐展开代码的画卷
</div>
<Spacer />

### 1.领悟思想

Express 是基于 Node.js 平台，快速、开放、极简的 Web 开发框架。意思是我们具有高度的可扩展性,不会受到太多限制。

### 2.源码分析

在源码分析的时候,我并不会把`express`的全貌托出,在这一章节,说过的,从一个简单的`http`服务开始。

- `http`模块
  ```js
  const http = require('http')
  const server = http
    .createServer((req, res) => {
      res.end('hello express')
    })
    .listen(3000)
  ```

上面的代码块我们利用`node`的`http`模块实现了一个基础的服务,我们把它复杂化一下,把它作为一个创建服务的入口。
在开始编写这段服务前我们可以看到`express`源码*lib*目录下的`express.js`这个我们的`express`框架的项目入口。
我们可以看到它依赖于<Link href="https://www.npmjs.com/package/merge-descriptors" target={"\_blank"} block color icon>`merge-descriptors`</Link>

```js
const http = require('http')
const mixin = require('merge-descriptors')

function createServer() {
  const app = function (req, res) {
    res.end('hello express')
  }
  mixin(app, proto, false)
  return app
}

const proto = Object.create(null)
proto.listen = function (port) {
  const server = http.createServer(this)
  return server.listen.apply(port, arguments)
}

const app = createServer()
app.listen(3000)

mdoule.exports = createServer()
```

这样我们就完成了一个简单的`http`服务。对比`express`源码中`express.js`中*37*到*57*行 和`application.js`中的*616*到*619*行

### 3.源码理解以及讲解。

通过创建 `proto` 对象。往 `proto` 对象属性上挂载方法,同时在 mixin 的阶段把 proto 赋值给` app`让`app`具有 `listen` 方法

<Spacer y={5} />

export default ({ children }) => <Layout meta={meta}>{children}</Layout>
